# Видове Load Тестове

## Колко вида  load тестове има?

Едно приложение работи по различен начин в зависимост от обема и продължителността на трафика, който обработва във всеки един момент. Никога не трябва да приемате, че приложението ви ще работи по същия начин, когато поддържа 10 или 100 потребители срещу 1000 или 5000 потребители и повече.

Има шест често срещани вида тестове за натоварване, които можете да изпълните на вашите приложения, за да измерите производителността при различни натоварвания.

## Smoke Тест

Smoke тестовете или Тестовете за дим проверяват функционирането на системата с минимално натоварване и се използват за събиране на базови стойности на производителност. Тестовете за дим се наричат ​​още тестове за разклащане.

![](/Attachments/SE-Load-Testing-Types-Pic-1.png)

Този тип тест се състои от провеждане на тестове с няколко VU. Например, повече от 5 виртуални потребители (VU) могат да се считат за тест за мини натоварване. По подобен начин тестът трябва да се изпълнява за кратък период от време, или малък брой повторения, или продължителност от секунди до максимум няколко минути.

![](/Attachments/SE-Load-Testing-Types-Pic-2.png)

## Average load тест натовареност

Average load тестовете или Тестовете за средно натоварване оценяват как системата работи при типично натоварване за вашата система или приложение. Типичното натоварване може да бъде нормален ден в производството или среден период от време в ежедневния ви трафик. Този тест също може да се нарече тест за деня в живота или тест за обем.

![](/Attachments/SE-Load-Testing-Types-Pic-3.png)

Тестовете за средно натоварване симулират броя на едновременните потребители и заявките за секунда, които отразяват средното поведение в производствената среда. Този тип тест обикновено увеличава пропускателната способност или VU постепенно и поддържа това средно натоварване за известно време. В зависимост от характеристиките на системата, тестът може да спре внезапно или да има кратък период на намаляване.

![](/Attachments/SE-Load-Testing-Types-Pic-4.png)

## Стрес тест

Стрес тестовете ви помагат да откриете как функционира системата с натоварване при пиков трафик. Стрес тестването може също да се нарече тестване в пиковите часове, тестване на пренапрежение или тестване на мащаба.

![](/Attachments/SE-Load-Testing-Types-Pic-5.png)

Стрес тестовете потвърждават стабилността и надеждността на системата при по-тежка от нормалната употреба. Системите може да получават по-високи от обичайните работни натоварвания, като крайни срокове на процесите, дни на заплащане, пикови часове, края на работната седмица и много други случаи, които могат да причинят често по-висок от средния трафик.

![](/Attachments/SE-Load-Testing-Types-Pic-6.png)

## Spike тест

Spike тест или пиков тест проверява дали системата оцелява и работи при внезапни и масивни пристъпи на използване.

![](/Attachments/SE-Load-Testing-Types-Pic-7.png)

Пиковите тестове са полезни, когато системата може да претърпи събития с изключителни обеми на трафик. Примери за такива събития включват продажба на билети (Тейлър Суифт), представяне на продукти (PS5), излъчване на реклами (Super Bowl), крайни срокове за обработка (данъчна декларация) и сезонни разпродажби (Черен петък). Освен това пиковете в трафика могат да бъдат причинени от по-чести събития, като например часове пик.

Пиковото тестване се увеличава до изключително високи натоварвания за много кратко или несъществуващо време за набиране. По същия начин намаляването е много бързо или изобщо не съществува, позволявайки на процеса да се повтори само веднъж.

Този тест може да включва процеси, различни от предишните типове тестове, тъй като скоковете често не са част от средния ден в производството. Може също така да изисква добавяне, премахване или модифициране на процеси в скрипта за тестване, които обикновено не са включени във вашите тестове за средно натоварване.

![](/Attachments/SE-Load-Testing-Types-Pic-8.png)

## Breakpoint тест

Breakpoint тестовете откриват ограниченията на вашата система. Тестването на точката на прекъсване е известно също като тестване на капацитет, точково натоварване и ограничение.

![](/Attachments/SE-Load-Testing-Types-Pic-9.png)

Причините, поради които може да искате да проведете тест за точка на прекъсване, включват:

- За да настроите или да се погрижите за слабите места на вашата система, за да преразпределите тези по-високи лимити на по-високи нива.

- За да помогнете да планирате стъпките за коригиране в тези случаи и да се подготвите, когато системата се доближи до тези граници.

Не става въпрос само за това да знаете в кой момент вашата система ще се провали. Това също е тест, който помага да се определи къде и как системата започва да се проваля и помага на екипите да се подготвят за такива ограничения.

Breakpoint тестът нараства до нереално високи числа. Този тест обикновено трябва да бъде спрян ръчно или автоматично, когато праговете започнат да се провалят. Когато се появят тези проблеми, системата е достигнала своите граници.

![](/Attachments/SE-Load-Testing-Types-Pic-10.png)

## Soak тест

Soak тестовете или тестовете за накисване са разновидност на теста със средно натоварване. Основната разлика е продължителността на теста. При тест за накисване пиковото натоварване обикновено е средно натоварване, но продължителността на пиковото натоварване продължава няколко часа или дори дни. Въпреки че продължителността е значително по-дълга, периодите на нарастване и спадане на теста за накисване са същите като при тест със средно натоварване.

![](/Attachments/SE-Load-Testing-Types-Pic-11.png)

Тестът за накисване може също да се нарече тест за издръжливост, постоянно високо натоварване или тест за издръжливост.

Тестовете за накисване се фокусират върху анализирането на следното:

- Влошаване на производителността и потреблението на ресурси на системата за продължителни периоди.
- Наличност и стабилност на системата за продължителни периоди.

![](/Attachments/SE-Load-Testing-Types-Pic-12.png)

## Обобщение на различните Load Тестове

| Тип          | Пропускателна Способност   | Продължение                 | Кога?                                                                                                                                    |
| ------------ | -------------------------- | --------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------- |
| Smoke        | Ниско                      | Кратко (секунди или минути) | Когато съответният код на системата или приложението се промени. Той проверява функционалната логика, базовите показатели и отклоненията |
| Average Load | Средно                     | Средно (5-60 минути)        | Често за проверка дали системата поддържа производителност при средна употреба                                                           |
| Stress       | Високо (Наднормено)        | Средно (5-60 минути)        | Когато системата може да получи натоварване над средното, за да проверите как се справя                                                  |
| Soak         | Средно                     | Дълго (часове)              | След промени за проверка на системата при продължителна непрекъсната употреба                                                            |
| Spike        | Много високо               | Кратко (няколко минути)     | Когато системата се подготвя за сезонни събития или получава чести пикове на трафика                                                     |
| Breakpoint   | Увеличава се до пречупване | Колкото е нужно             | Няколко пъти, за да намерите горните граници на системата                                                                                |

Общата цел на теста за натоварване определя вида на теста за натоварване, от който може да се нуждаете. След това типовете тестове, които изберете, ще информират как планирате, структурирате и изпълнявате своя тест за натоварване. Но всяко приложение, организация и проект за тестване се различават.

Препоръка за тестване на натоварване е винаги да започвате просто и да тествате често. Например, започнете с димни тестове, след това преминете към по-високи натоварвания и по-дълги продължителности. Винаги можете да повторите и разширите своя пакет за тестване, като добавите повече типове тестове за натоварване, докато постепенно включвате тестовете за натоварване във вашите работни процеси.

## Защо тестването с натоварване има значение

Изчерпателен набор от различни тестове за натоварване, внедрени във вашата система, в крайна сметка може да ви помогне да осигурите отлично потребителско изживяване.

Когато прилагате тестване за натоварване, вие гарантирате, че изживяването за потребителите е:

- **Бързо** - Интелигентните клиенти очакват уебсайтът ви да бъде бърз – независимо дали е в обикновен ден или по време на голямо събитие – и може да отведат бизнеса си до конкуренти, ако имат страници, работещи бавно.
- **Безгрешно** - Ако потребителите изпитват неизправности или грешки, те могат да публикуват за своите негативни преживявания в обществени форуми като социални медии и уебсайтове за прегледи на клиенти.
- **Положително** - Много фактори могат да доведат до отрицателно потребителско изживяване — бавност, грешки и т.н. Тестването на натоварването ви помага да гарантирате, че потребителите имат положителен опит, когато използват вашите приложения.

## k6 - Етапи

- В простите **load** тестовете на k6 са дефинирани основни параметри като виртуални потребители, итерации и продължение. При такива тестове k6 стартира дефинираният брой виртуални потребители, изпълнява определена заявка за поясненият период от време, и приключва.

![](/Attachments/SE-Load-Testing-Types-Pic-13.png)
- За направим теста по-реалистичен ние можем да симулираме периоди на покачване или на спад, където броят потребители постепенно се покачва, спазва определено ниво, и намалява.
![](/Attachments/SE-Load-Testing-Types-Pic-14.png)
- В този случай можем в опциите да зададаем етапи (**stages**) на теста, които да дефинират как натоварването ще се промени.
```js
export let options = {
  stages: [
    { duration: '30m', target: 100 },
    { duration: '1h', target: 100 },
    { duration: '5m', target: 0 },
  ],
};
```

- Горният пример дефинира три етапа на теста:
    1. Първият етап задава постепенно покачване от 0 VU до 100 VU.
    2. Вторият етап държи този брой потребители в продължение на 1 час.
    3. Третият етап постепенно намалява броят потребители до 0, след което тестът приключва.
- Етапите са най-универсалният начин за дефиниране на тестови параметри за единичен сценарий. Те ви дават гъвкавост при оформяне на натоварването на вашия тест, за да съответства на ситуацията, която се опитвате да симулирате.
- Пълен примерен тест с етапи:

```js
import http from 'k6/http';
import { check, sleep } from 'k6';

export let options = {
  stages: [
    { duration: '30m', target: 100 },
    { duration: '1h', target: 100 },
    { duration: '5m', target: 0 },
  ],
};

export default function () {
  let res = http.get('https://test.k6.io');
  check(res, {
    'status is 200': (r) => r.status === 200,
  });
  sleep(Math.random() * 5);
}
```

## Задание

- Вземете приложението, което сте направили миналото задание. Добавете load тестове от всички основни типове, разгледани в урока.
